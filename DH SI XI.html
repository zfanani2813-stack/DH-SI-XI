<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Daftar Hadir Seni Budaya</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
        body { 
            font-family: 'Inter', sans-serif; 
            background-color: #f1f5f9;
        }
        .status-select {
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            transition: all 0.3s ease;
        }
        .select-hadir { border-color: #10b981; color: #059669; background-color: #f0fdf4; }
        .select-telat { border-color: #f59e0b; color: #d97706; background-color: #fffbeb; }
        .select-izin { border-color: #3b82f6; color: #2563eb; background-color: #eff6ff; }
        .select-sakit { border-color: #8b5cf6; color: #7c3aed; background-color: #f5f3ff; }
        .select-alpa { border-color: #ef4444; color: #dc2626; background-color: #fef2f2; }
        .select-bolos { border-color: #f97316; color: #c2410c; background-color: #fff7ed; }
        
        #toast {
            visibility: hidden;
            min-width: 280px;
            margin-left: -140px;
            color: #fff;
            text-align: center;
            border-radius: 16px;
            padding: 16px;
            position: fixed;
            z-index: 100;
            left: 50%;
            bottom: 100px;
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.3s ease;
        }
        #toast.show {
            visibility: visible;
            opacity: 1;
            transform: translateY(0);
        }
    </style>
</head>
<body class="pb-32">

    <div id="toast"></div>

    <!-- Header -->
    <div class="bg-white border-b border-gray-300 sticky top-0 z-20 shadow-sm">
        <div class="max-w-2xl mx-auto px-4 py-4 flex flex-col space-y-3">
            <div class="flex items-start justify-between">
                <div class="flex-grow">
                    <h1 class="text-lg md:text-xl font-bold text-gray-800 leading-tight">Daftar Hadir Seni Budaya</h1>
                    <p class="text-xs font-semibold text-blue-700">Guru: Indah Widianing Tyas, S.Pd</p>
                </div>
                <!-- Dropdown Pilih Kelas -->
                <div class="flex flex-col items-end space-y-1">
                    <label class="text-[10px] font-bold text-gray-500 uppercase tracking-wider">Pilih Kelas</label>
                    <select id="class-selector" onchange="changeClass()" 
                        class="bg-gray-800 text-white text-xs font-bold px-3 py-1.5 rounded-lg border border-gray-700 outline-none cursor-pointer focus:ring-2 focus:ring-blue-500 transition-all">
                        <option value="XI TITL">XI TITL</option>
                        <option value="XI TJTL">XI TJTL</option>
                        <option value="XI TPTU">XI TPTU</option>
                        <option value="XI MEKATRONIKA">XI MEKATRONIKA</option>
                        <option value="XI TOI">XI TOI</option>
                        <option value="XI TEI">XI TEI</option>
                        <option value="XI TSM">XI TSM</option>
                        <option value="XI TKR">XI TKR</option>
                        <option value="XI TLAS">XI TLAS</option>
                    </select>
                </div>
            </div>

            <div class="flex items-center justify-between pt-1">
                <div class="bg-gray-100 rounded-lg px-3 py-1.5 flex items-center border border-gray-200 shadow-inner">
                    <svg class="w-3.5 h-3.5 text-gray-500 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2-2v12a2 2 0 002 2z"></path>
                    </svg>
                    <input type="date" id="attendance-date" class="bg-transparent text-xs text-gray-700 font-bold outline-none">
                </div>
                <div class="flex items-center space-x-2">
                    <span id="class-badge" class="text-[10px] font-black bg-blue-100 text-blue-700 px-2 py-1 rounded-md border border-blue-200 uppercase">XI TITL</span>
                    <span id="student-count" class="text-[10px] font-black bg-gray-100 text-gray-600 px-2 py-1 rounded-md border border-gray-200 uppercase">0 SISWA</span>
                </div>
            </div>
        </div>
    </div>

    <div class="max-w-2xl mx-auto p-4">
        <form id="attendanceForm">
            <div class="bg-white rounded-3xl shadow-lg border border-gray-300 overflow-hidden">
                <table class="w-full text-left">
                    <thead class="bg-gray-800 border-b border-gray-700 text-white">
                        <tr>
                            <th class="px-5 py-4 text-xs font-bold uppercase tracking-wider">Nama Siswa</th>
                            <th class="px-5 py-4 text-xs font-bold uppercase tracking-wider text-right w-32">Status</th>
                        </tr>
                    </thead>
                    <tbody id="studentContainer" class="divide-y divide-gray-200"></tbody>
                </table>
            </div>

            <div class="fixed bottom-0 left-0 right-0 p-4 bg-white/90 backdrop-blur-md border-t border-gray-300 flex justify-center z-30">
                <button type="submit" id="submitBtn"
                    class="w-full max-w-md bg-blue-700 hover:bg-blue-800 text-white font-bold py-4 rounded-2xl shadow-xl transition-all active:scale-[0.95] flex items-center justify-center group">
                    <svg id="loader" class="animate-spin -ml-1 mr-3 h-5 w-5 text-white hidden" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                    </svg>
                    <span id="btnText">Kirim Rekap <span id="btn-class-label">XI TITL</span></span>
                </button>
            </div>
        </form>
    </div>

    <script>
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbycr13_AX82KHAaoxx1iPSxbxuWUqP1uB4xBiDe6XL3TjHw2p6jSvBmFKl6ObXuv6MN/exec'; 

        const databaseSiswa = {
            "XI TITL": [
                "ABDUL MUKTI", "AHMAD SUHERMAN", "ALWANI LAIKA", "ANISA", "BAKI NASUHA", 
                "BAIQ WIDYA LUNA KUSUMA DEWI", "BAYU SAPUTRA", "DUNY ARDIKA PRATAMA", 
                "FATHURRAHMAN", "LALU MUHAMMAD ALIAKBAR", "MULTAZAM", "MALIK ABDUL AZIZ", 
                "MUHAJIRIN", "MUHAMAD HAEKAL", "NURAHIM", "SELPI KARINSA", "SITI AISYAH", 
                "WISNU ARIYANTO", "ZAHRUL", "YADI SAPUTRA", "ZIDAN DESTA HARIANTO", "ZUL FIRMAN"
            ],
            "XI TJTL": [
                "ADRIAN TRISNO", "AGUS GUNAWAN SYAHBAN", "AHMAD AKBAR", "ANDIKA PRATAMA", 
                "ANJAS FADEL ANDIKA", "ARYA SAPUTRA", "BAIQ SEPA PUTRI APRILIA", 
                "DIKA SIBNU SEJARAH", "DARUMDIA", "FHAQIHUN ALIF", "GINA ASRI", 
                "I PUTU DIVA YUDISTIRA PRAMANA", "IRFAN HUMAIDI", "MARTIN", 
                "MUHAMMAD IRHAMDI", "M. KHOLID SAPUTRA", "RENI ALFIANA", "RUHASA", 
                "RUSLAN", "SARI AYU", "SUEL AHMAD ZAKI"
            ],
            "XI TPTU": [
                "ADAM ADRIAN", "AHMAD MADANI", "AHMAD MUZAKKIR", "ARIF ILHAM", 
                "AZFAR ZAID HABIBULLOH", "AZWAN", "GIGIH RAMADHAN JUNAIDI", 
                "HABIB DARUL FALAH", "HILMAN MAULANA", "INDRA APRIANTO", 
                "JAENUL ANWAR", "JUMA'AH", "MUHAMMAD ADRIAN PUTRA", 
                "MUHAMMAD ARJUN", "MUHAMAD IMRON ROHADI", "MUHAMMAD ARIYA RAMADAN", 
                "MUHAMMAD EGA INDRAWAN", "M. IKBAL WAHYUDI", "SAHDI", "SAHLUR RIDHO"
            ],
            "XI MEKATRONIKA": [
                "AGUS SUHANDI", "ANTONI", "AMANDA SAFIRA", "BAIQ JUNITA CAHYA PURNAMA", 
                "DIAN SEPTIANI LESTARI", "HUMAERO", "NURHALIZA", "MUHAMMAD RIZAL", 
                "RIFAN WAHYUDI", "RAHMATUN ISLAMIAH", "SERIAYU", "SIFA OKTAVIA", 
                "SUDIRMAN", "ZIVANA KEYSYA HERMAYANTI"
            ],
            "XI TOI": [
                "ANINDYA PUTRI WIJAYANTI", "AMELINDA", "ARYA MAULA RIZKI", "AULIA SAPUTRI", 
                "BAIQ ALMALA", "FEBY ISTIANI", "JIRIN FIRMAN MAULANA", "JANUAR PRATAMA", 
                "LALU MUHAMMAD FAHRI PRATAMA", "MAYANI", "MELVA SAFIRA HERMANIANDINI", 
                "MUHAMMAD SANUSI", "MULIANA PUTRI", "SITI AISYAH"
            ],
            "XI TEI": [
                "ACHMAD GHATHFAAN LUTHFI KAISAN", "AL-GINA FATAYATUSSIFA", "CAHAYA HAERANI", 
                "HELMI YANTI FEBRIANTI", "INDAH YANI", "IMAM SAMUDRA", "IRWAN JAYADI", 
                "NAZWA PUTRI ARTANTI", "NURUL FALLAH", "MUHAMMAD KELFIN", "RAHMADHANIA", 
                "RULI ALIA PUTRI", "ROHAENI", "SUHARTINI", "USI EKA WARDANI"
            ],
            "XI TSM": [
                "AHMAD ADRIADI", "ANDRIANSYAH", "DENI MINAH LESTARI", "EVHAN KUMALA FITRA", 
                "HAERIL YADI", "HAEKAL YADI", "HAMDI", "IKHWANUL IHSAN", "IJAN ROSIDI", 
                "INDRA SAPUTRA", "LALU DRUARA", "LALU SAKY ALFAREZY", "LALU DARU JIRAW", 
                "LALU TA'LIP HULAIPI", "MUHAMMAD MARULLAH", "MUHAMMAD MUHARAR HAIDIR ALI", 
                "MUHAMMAD RAMDANI", "RIVALDI ARJUNA PUTRA RINALDI", "SALMAN FAROJI", "ZIDAN JASTIRA"
            ],
            "XI TKR": [
                "ABDUL HARIS", "ADAM PURIAWAN", "AHMAD FIQI HOILID", "AHMAD SAHRUL", 
                "ALDI ALFA RIZKI", "ALVIAN FIRMANSYAH", "DIKY WAHYUDIANSYAH", 
                "FEBRIAN SYAH REZA", "IBNU ARIF", "KHAIRIL ILHAM", "M ALFIN AL FARIZI", 
                "M. EKA RIDWAN SAPUTRA", "MUHAMMAD NABIL JULIAN HADI", "RENO ANDIKA", 
                "REZA M. FALAQ ALFIAN", "RIANDI", "SAFWAN HADI", "YAHDI FAHREZI", "ZIKRULLAH"
            ],
            "XI TLAS": [
                "AHMAD PADLI", "AKMAD HIDAYATULLOH", "ANDIKA APRIANTO", "ASFARI", 
                "FAHRUL ROZI", "IRGI ARDIANSYAH", "JILAL AHMAD GILANG", "LAILATUL FAHRI", 
                "MUHAMMAD RIZNAN", "RAFLI FATURRAHMAN", "SUHARDITTIYAWAN", "TONY GUNAWAN", 
                "ULUL AZMI"
            ]
        };

        const container = document.getElementById('studentContainer');
        const classSelector = document.getElementById('class-selector');
        const classBadge = document.getElementById('class-badge');
        const btnClassLabel = document.getElementById('btn-class-label');
        const studentCountLabel = document.getElementById('student-count');
        const datePicker = document.getElementById('attendance-date');
        const toast = document.getElementById('toast');
        const form = document.getElementById('attendanceForm');
        const btn = document.getElementById('submitBtn');
        const loader = document.getElementById('loader');

        datePicker.value = new Date().toISOString().split('T')[0];

        function changeClass() {
            const selectedClass = classSelector.value;
            classBadge.innerText = selectedClass;
            btnClassLabel.innerText = selectedClass;
            renderStudents(selectedClass);
        }

        function renderStudents(namaKelas) {
            const siswa = databaseSiswa[namaKelas];
            if (!siswa) {
                container.innerHTML = '<tr><td colspan="2" class="px-5 py-4 text-center text-sm text-red-500 font-bold">Data kelas tidak ditemukan</td></tr>';
                studentCountLabel.innerText = "0 SISWA";
                return;
            }
            
            studentCountLabel.innerText = `${siswa.length} SISWA`;
            
            container.innerHTML = siswa.map((nama, index) => {
                const stripeClass = (index % 2 === 0) ? 'bg-white' : 'bg-slate-50';
                return `
                <tr class="${stripeClass} hover:bg-blue-50 transition-colors">
                    <td class="px-5 py-4 border-r border-gray-100">
                        <p class="text-sm font-bold text-gray-800">${nama}</p>
                    </td>
                    <td class="px-5 py-4 text-right">
                        <select name="status_${index}" data-nama="${nama}" onchange="updateStyle(this)"
                            class="status-select select-hadir border-2 text-[10px] font-black rounded-xl p-2 outline-none w-full max-w-[110px]">
                            <option value="Hadir">HADIR</option>
                            <option value="Hadir Telat">TELAT</option>
                            <option value="Izin">IZIN</option>
                            <option value="Sakit">SAKIT</option>
                            <option value="Alpa">ALPA</option>
                            <option value="Bolos">BOLOS</option>
                        </select>
                    </td>
                </tr>`;
            }).join('');
        }

        function updateStyle(select) {
            select.classList.remove('select-hadir', 'select-telat', 'select-izin', 'select-sakit', 'select-alpa', 'select-bolos');
            const val = select.value;
            if (val === 'Hadir') select.classList.add('select-hadir');
            else if (val === 'Hadir Telat') select.classList.add('select-telat');
            else if (val === 'Izin') select.classList.add('select-izin');
            else if (val === 'Sakit') select.classList.add('select-sakit');
            else if (val === 'Alpa') select.classList.add('select-alpa');
            else if (val === 'Bolos') select.classList.add('select-bolos');
        }

        function showToast(message, type = 'success') {
            toast.innerText = message;
            toast.style.backgroundColor = (type === 'success') ? '#10b981' : '#ef4444';
            toast.classList.add('show');
            setTimeout(() => toast.classList.remove('show'), 4000);
        }

        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            btn.disabled = true;
            loader.classList.remove('hidden');
            
            const selectedClass = classSelector.value;
            const selects = form.querySelectorAll('select[name^="status_"]');
            
            const payload = Array.from(selects).map(sel => ({
                tanggal: datePicker.value,
                nama: sel.getAttribute('data-nama'),
                status: sel.value,
                kelas: selectedClass 
            }));

            try {
                const response = await fetch(SCRIPT_URL, {
                    method: 'POST',
                    body: JSON.stringify(payload)
                });
                const result = await response.json();
                if (result.result === "success") {
                    showToast(`✅ Rekap ${selectedClass} Berhasil!`, 'success');
                } else { throw new Error(); }
            } catch (error) {
                showToast('❌ Gagal Mengirim. Cek Koneksi.', 'error');
            } finally {
                btn.disabled = false;
                loader.classList.add('hidden');
            }
        });

        // Initialize
        changeClass();
    </script>
</body>
</html>